<!DOCTYPE html>
<html>
<head>
  <title>Mage Chat</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    #messages { margin-top: 20px; }
    .message { border-bottom: 1px solid #ccc; padding: 5px 0; background: #fff; margin: 5px 0; border-radius: 4px; padding: 10px; }
    input { padding: 10px; width: 250px; }
    button { padding: 10px 15px; margin-left: 5px; }
    h1 { color: #4B0082; }
  </style>
</head>
<body>
  <h1>ðŸ§™ Mage Chat</h1>
  <input id="msgInput" placeholder="Enter your message..." />
  <button onclick="sendMessage()">Send</button>
  <button onclick="deleteAllMessages()" style="background: red; color: white;">Delete All</button>

  <div id="messages"></div>

  <script>
    // Firebase config with your credentials
    const firebaseConfig = {
      apiKey: "AIzaSyBPf3e1v1rJ5UkhDJS42fR5vpWyXQhbF7g",
      authDomain: "id12-a1a42.firebaseapp.com",
      databaseURL: "https://id12-a1a42-default-rtdb.firebaseio.com",
      projectId: "id12-a1a42",
      storageBucket: "id12-a1a42.firebasestorage.app",
      messagingSenderId: "970958451595",
      appId: "1:970958451595:web:9ec5cc265b505798d2758e",
      measurementId: "G-G4ND0NEYQT"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Anonymous auth
    firebase.auth().signInAnonymously();

    const messagesRef = db.collection("mage_chat");

    // Send message
    function sendMessage() {
      const input = document.getElementById("msgInput");
      const message = input.value.trim();
      if (message) {
        messagesRef.add({
          text: message,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        input.value = "";
      }
    }

    // Display messages in real-time
    messagesRef.orderBy("timestamp").onSnapshot(snapshot => {
      const messagesDiv = document.getElementById("messages");
      messagesDiv.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        messagesDiv.innerHTML += `<div class="message">${data.text}</div>`;
      });
    });

    // Delete all messages
    function deleteAllMessages() {
      if (confirm("Are you sure you want to delete all messages? This cannot be undone.")) {
        messagesRef.get().then(snapshot => {
          const batch = db.batch();
          snapshot.forEach(doc => batch.delete(doc.ref));
          return batch.commit();
        }).catch(error => {
          console.error("Error deleting messages: ", error);
        });
      }
    }
  </script>
</body>
</html>
